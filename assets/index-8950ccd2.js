var x=Object.defineProperty,m=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,k=(e,t,o)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,R=(e,t)=>{for(var o in t||(t={}))E.call(t,o)&&k(e,o,t[o]);if(m)for(var o of m(t))C.call(t,o)&&k(e,o,t[o]);return e},F={Cell:'[role="cell"],[role="gridcell"],[role="columnheader"],[role="rowheader"],td,th',Row:'[role="row"],tr',RowGroup:'[role="rowgroup"],thead,tbody,tfoot',Focusable:'a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not([aria-disabled="true"]):not([tabindex="-1"]):not(:disabled),*[tabindex]'},N=class{constructor(e={}){this.keys=[],this.debugLog=(n,l)=>{this.debug&&console.info(`[${n}]: ${l}`)};const{selectors:t={},pageUpDown:o,debug:i=!1}=e;this.selectors=R(R({},F),t),this.pageUpDown=o,this.keys=[],this.debug=i,this.disabled=!1}disable(){this.disabled=!0}enable(){this.disabled=!1}isFocusable(e){return e instanceof HTMLElement||e instanceof SVGElement}tableKeyUp(){this.keys=[]}tableKeyDown(e){var t;if(this.debugLog("tableKeyDown",`Key pressed: ${e.key}`),this.disabled){this.debugLog("tableKeyDown","interaction is disabled");return}if((e.key==="ArrowDown"||e.key==="ArrowUp"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&e.preventDefault(),(this.keys.length===0||this.keys[this.keys.length-1]!==e.key)&&this.keys.push(e.key),!(e.target instanceof Element))return;const o=(t=e.target.parentElement)==null?void 0:t.closest(`${this.selectors.Cell},${this.selectors.Row}`);if(!o){this.debugLog("tableKeyDown","cell not found");return}o.matches(this.selectors.Cell)?(this.debugLog("tableKeyDown","event captured in cell"),this.cellNavigation(e)):(this.debugLog("tableKeyDown","event captured in cell"),this.gridNavigation(e))}cellNavigation(e){if(e.target instanceof Element){if(e.key==="Escape"){const t=e.target.closest(this.selectors.Cell);if(t&&this.isFocusable(t)){t.focus();return}}if(e.key==="ArrowRight"||e.key==="ArrowDown"){const t=e.target.closest(this.selectors.Cell);if(!t){this.debugLog("cellNavigation","cell not found");return}const o=[...t.querySelectorAll(this.selectors.Focusable)],i=o.findIndex(s=>s===e.target),n=i===o.length-1?0:i+1,l=o[n];this.isFocusable(l)&&l.focus();return}if(e.key==="ArrowLeft"||e.key==="ArrowUp"){const t=e.target.closest(this.selectors.Cell);if(!t){this.debugLog("cellNavigation","cell not found");return}const o=[...t.querySelectorAll(this.selectors.Focusable)],i=o.findIndex(s=>s===e.target),n=i===0?o.length-1:i-1,l=o[n];this.isFocusable(l)&&l.focus();return}}}gridNavigation(e){var t;const{target:o}=e;if(e.target instanceof Element&&o instanceof Element)if(this.keys.length===1){if(e.key==="Enter"){const i=e.target.querySelector(this.selectors.Focusable);i&&this.isFocusable(i)&&(i.focus(),e.preventDefault())}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){const i=e.key==="ArrowLeft"?"prev":"next",n=e.target.closest(this.selectors.Cell);if(n&&n instanceof Element){const l=this.findUntil(i,n,this.selectors.Cell);l&&l.focus()}}if(e.key==="ArrowDown"||e.key==="ArrowUp"){this.verticalCellNavigation(e);return}if(e.key==="PageUp"||e.key==="PageDown"){this.pageCellNavigation(e);return}if(e.key==="Home"||e.key==="End"){const i=e.target.closest(this.selectors.Row),n=[...(i==null?void 0:i.children)||[]];e.key==="End"&&n.reverse(),this.focusOnFirstCell(n)}}else{const[i,n]=this.keys;if(i==="Control"&&(n==="Home"||n==="End")){const s=(t=e.target.closest(this.selectors.Row).parentElement)==null?void 0:t.children;if(!s){this.debugLog("cellNavigation","siblings not found");return}const a=n==="Home"?s[0]:s[s.length-1],c=[...(a==null?void 0:a.children)||[]];n==="End"&&c.reverse(),this.focusOnFirstCell(c)}}}pageCellNavigation(e){var t;if(!(e.target instanceof Element))return;const o=e.target.closest(this.selectors.Row),i=e.target.closest(this.selectors.Cell);if(o&&i){const n=this.getColumnIndex(i);if(n===void 0){this.debugLog("cellNavigation","position not found");return}const l=e.key==="PageUp"?"prev":"next",s=(t=o.parentElement)==null?void 0:t.children;if(!s){this.debugLog("cellNavigation","siblings not found");return}let a;if(this.pageUpDown){const u=l==="prev"?"previousSibling":"nextSibling";let r=o[u];if(r===null)return;let b=r;for(let h=0;h<this.pageUpDown-1&&r;h++)r=r[u],r&&(b=r);a=r||b}else a=l==="prev"?s[0]:s[s.length-1];if(!a||!(a instanceof Element))return;const c=a.children[n];c&&this.isFocusable(c)&&c.focus()}}verticalCellNavigation(e){var t,o,i,n,l;if(!(e.target instanceof Element))return;const s=e.target.closest(this.selectors.Row),a=e.target.closest(this.selectors.Cell);if(s&&a){const c=this.getColumnIndex(a),u=this.getRowIndex(s);if(this.debugLog("gridNavigation",`Initial row position: ${u}`),this.debugLog("gridNavigation",`Initial cell position: ${c}`),c===void 0||u===void 0){this.debugLog("verticalCellNavigation","row or cell position not found");return}const r=e.key==="ArrowUp"?"prev":"next";if(u===0&&r==="prev"){const d=(t=s.parentElement)==null?void 0:t.closest(this.selectors.RowGroup),f=[...((o=d==null?void 0:d.parentElement)==null?void 0:o.children)||[]],w=f.findIndex(p=>p===d);if(w!==0){const y=[...f[w-1].querySelectorAll(this.selectors.Row)],g=y[y.length-1].children[c];g&&this.isFocusable(g)&&g.focus();return}}const b=[...((i=s.parentElement)==null?void 0:i.querySelectorAll(this.selectors.Row))||[]];if(u===b.length-1&&r==="next"){const d=(n=s.parentElement)==null?void 0:n.closest(this.selectors.RowGroup),f=[...((l=d==null?void 0:d.parentElement)==null?void 0:l.children)||[]],w=f.findIndex(p=>p===d);if(w!==f.length-1){const g=[...f[w+1].querySelectorAll(this.selectors.Row)][0].children[c];g&&this.isFocusable(g)&&g.focus();return}return}const h=this.findUntil(r,s,this.selectors.Row);if(!h)return;const v=h.children[c];v&&this.isFocusable(v)&&v.focus()}}focusOnFirstCell(e){for(let t=0;t<e.length;t++){const o=e[t];if(this.isFocusable(o)){o.focus();return}}}getColumnIndex(e){var t;let o=0;const i=(t=e==null?void 0:e.parentNode)==null?void 0:t.children;if(i){for(;e!==i[o]&&i[o]!==void 0;)o++;if(i[o]===void 0){this.debugLog("getColumnIndex","position finding was not successful");return}return o}}getRowIndex(e){var t;let o=0;const i=(t=e==null?void 0:e.parentNode)==null?void 0:t.children;if(i){for(;e!==i[o]&&i[o]!==void 0;)o++;if(i[o]===void 0){this.debugLog("getRowIndex","position finding was not successful");return}return o}}findUntil(e,t,o,i){let n=t;const l=e==="next"?"nextSibling":"previousSibling";for(;n[l];){const s=n[l];if(!s||i&&s instanceof Element&&s.matches(i))return null;if(s instanceof Element&&s.matches(o))return s;n=s}return null}};function _(e){const t=new N(e);return{listeners:{onKeyDown:o=>t.tableKeyDown(o),onKeyUp:()=>t.tableKeyUp()},tableNav:t}}export{_ as u};
//# sourceMappingURL=index-8950ccd2.js.map
